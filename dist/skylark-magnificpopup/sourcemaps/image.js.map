{"version":3,"sources":["image.js"],"names":["define","$","_imgInterval","magnificPopup","registerModule","options","markup","cursor","titleSrc","verticalFit","tError","proto","initImage","imgSt","mfp","st","image","ns","types","push","_mfpOn","OPEN_EVENT","currItem","type","document","body","addClass","CLOSE_EVENT","removeClass","_window","off","EVENT_NS","resizeImage","isLowIE","item","img","decr","parseInt","css","wH","_onImageHasSize","hasSize","clearInterval","isCheckingImgSize","_mfpTrigger","imgHidden","content","findImageSize","counter","mfpSetInterval","delay","setInterval","naturalWidth","getImage","template","guard","onLoadComplete","complete","updateStatus","loaded","setTimeout","onLoadError","replace","src","loadError","el","find","length","createElement","className","alt","attr","on","is","clone","width","_parseMarkup","title","data","undefined","isFunction","call","_getTitle","img_replaceWith","loading"],"mappings":"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","file":"../image.js","sourcesContent":["define([\n\t\"skylark-jquery\",\n\t\"./core\"\n],function($) {\n\tvar _imgInterval,\n\t\t_getTitle = function(item) {\n\t\t\tif(item.data && item.data.title !== undefined)\n\t\t\t\treturn item.data.title;\n\n\t\t\tvar src = mfp.st.image.titleSrc;\n\n\t\t\tif(src) {\n\t\t\t\tif($.isFunction(src)) {\n\t\t\t\t\treturn src.call(mfp, item);\n\t\t\t\t} else if(item.el) {\n\t\t\t\t\treturn item.el.attr(src) || '';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn '';\n\t\t};\n\n\t$.magnificPopup.registerModule('image', {\n\n\t\toptions: {\n\t\t\tmarkup: '<div class=\"mfp-figure\">'+\n\t\t\t\t\t\t'<div class=\"mfp-close\"></div>'+\n\t\t\t\t\t\t'<figure>'+\n\t\t\t\t\t\t\t'<div class=\"mfp-img\"></div>'+\n\t\t\t\t\t\t\t'<figcaption>'+\n\t\t\t\t\t\t\t\t'<div class=\"mfp-bottom-bar\">'+\n\t\t\t\t\t\t\t\t\t'<div class=\"mfp-title\"></div>'+\n\t\t\t\t\t\t\t\t\t'<div class=\"mfp-counter\"></div>'+\n\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t'</figcaption>'+\n\t\t\t\t\t\t'</figure>'+\n\t\t\t\t\t'</div>',\n\t\t\tcursor: 'mfp-zoom-out-cur',\n\t\t\ttitleSrc: 'title',\n\t\t\tverticalFit: true,\n\t\t\ttError: '<a href=\"%url%\">The image</a> could not be loaded.'\n\t\t},\n\n\t\tproto: {\n\t\t\tinitImage: function() {\n\t\t\t\tvar imgSt = mfp.st.image,\n\t\t\t\t\tns = '.image';\n\n\t\t\t\tmfp.types.push('image');\n\n\t\t\t\t_mfpOn(OPEN_EVENT+ns, function() {\n\t\t\t\t\tif(mfp.currItem.type === 'image' && imgSt.cursor) {\n\t\t\t\t\t\t$(document.body).addClass(imgSt.cursor);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_mfpOn(CLOSE_EVENT+ns, function() {\n\t\t\t\t\tif(imgSt.cursor) {\n\t\t\t\t\t\t$(document.body).removeClass(imgSt.cursor);\n\t\t\t\t\t}\n\t\t\t\t\t_window.off('resize' + EVENT_NS);\n\t\t\t\t});\n\n\t\t\t\t_mfpOn('Resize'+ns, mfp.resizeImage);\n\t\t\t\tif(mfp.isLowIE) {\n\t\t\t\t\t_mfpOn('AfterChange', mfp.resizeImage);\n\t\t\t\t}\n\t\t\t},\n\t\t\tresizeImage: function() {\n\t\t\t\tvar item = mfp.currItem;\n\t\t\t\tif(!item || !item.img) return;\n\n\t\t\t\tif(mfp.st.image.verticalFit) {\n\t\t\t\t\tvar decr = 0;\n\t\t\t\t\t// fix box-sizing in ie7/8\n\t\t\t\t\tif(mfp.isLowIE) {\n\t\t\t\t\t\tdecr = parseInt(item.img.css('padding-top'), 10) + parseInt(item.img.css('padding-bottom'),10);\n\t\t\t\t\t}\n\t\t\t\t\titem.img.css('max-height', mfp.wH-decr);\n\t\t\t\t}\n\t\t\t},\n\t\t\t_onImageHasSize: function(item) {\n\t\t\t\tif(item.img) {\n\n\t\t\t\t\titem.hasSize = true;\n\n\t\t\t\t\tif(_imgInterval) {\n\t\t\t\t\t\tclearInterval(_imgInterval);\n\t\t\t\t\t}\n\n\t\t\t\t\titem.isCheckingImgSize = false;\n\n\t\t\t\t\t_mfpTrigger('ImageHasSize', item);\n\n\t\t\t\t\tif(item.imgHidden) {\n\t\t\t\t\t\tif(mfp.content)\n\t\t\t\t\t\t\tmfp.content.removeClass('mfp-loading');\n\n\t\t\t\t\t\titem.imgHidden = false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Function that loops until the image has size to display elements that rely on it asap\n\t\t\t */\n\t\t\tfindImageSize: function(item) {\n\n\t\t\t\tvar counter = 0,\n\t\t\t\t\timg = item.img[0],\n\t\t\t\t\tmfpSetInterval = function(delay) {\n\n\t\t\t\t\t\tif(_imgInterval) {\n\t\t\t\t\t\t\tclearInterval(_imgInterval);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// decelerating interval that checks for size of an image\n\t\t\t\t\t\t_imgInterval = setInterval(function() {\n\t\t\t\t\t\t\tif(img.naturalWidth > 0) {\n\t\t\t\t\t\t\t\tmfp._onImageHasSize(item);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif(counter > 200) {\n\t\t\t\t\t\t\t\tclearInterval(_imgInterval);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcounter++;\n\t\t\t\t\t\t\tif(counter === 3) {\n\t\t\t\t\t\t\t\tmfpSetInterval(10);\n\t\t\t\t\t\t\t} else if(counter === 40) {\n\t\t\t\t\t\t\t\tmfpSetInterval(50);\n\t\t\t\t\t\t\t} else if(counter === 100) {\n\t\t\t\t\t\t\t\tmfpSetInterval(500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, delay);\n\t\t\t\t\t};\n\n\t\t\t\tmfpSetInterval(1);\n\t\t\t},\n\n\t\t\tgetImage: function(item, template) {\n\n\t\t\t\tvar guard = 0,\n\n\t\t\t\t\t// image load complete handler\n\t\t\t\t\tonLoadComplete = function() {\n\t\t\t\t\t\tif(item) {\n\t\t\t\t\t\t\tif (item.img[0].complete) {\n\t\t\t\t\t\t\t\titem.img.off('.mfploader');\n\n\t\t\t\t\t\t\t\tif(item === mfp.currItem){\n\t\t\t\t\t\t\t\t\tmfp._onImageHasSize(item);\n\n\t\t\t\t\t\t\t\t\tmfp.updateStatus('ready');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\titem.hasSize = true;\n\t\t\t\t\t\t\t\titem.loaded = true;\n\n\t\t\t\t\t\t\t\t_mfpTrigger('ImageLoadComplete');\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// if image complete check fails 200 times (20 sec), we assume that there was an error.\n\t\t\t\t\t\t\t\tguard++;\n\t\t\t\t\t\t\t\tif(guard < 200) {\n\t\t\t\t\t\t\t\t\tsetTimeout(onLoadComplete,100);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tonLoadError();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\t// image error handler\n\t\t\t\t\tonLoadError = function() {\n\t\t\t\t\t\tif(item) {\n\t\t\t\t\t\t\titem.img.off('.mfploader');\n\t\t\t\t\t\t\tif(item === mfp.currItem){\n\t\t\t\t\t\t\t\tmfp._onImageHasSize(item);\n\t\t\t\t\t\t\t\tmfp.updateStatus('error', imgSt.tError.replace('%url%', item.src) );\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\titem.hasSize = true;\n\t\t\t\t\t\t\titem.loaded = true;\n\t\t\t\t\t\t\titem.loadError = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\timgSt = mfp.st.image;\n\n\n\t\t\t\tvar el = template.find('.mfp-img');\n\t\t\t\tif(el.length) {\n\t\t\t\t\tvar img = document.createElement('img');\n\t\t\t\t\timg.className = 'mfp-img';\n\t\t\t\t\tif(item.el && item.el.find('img').length) {\n\t\t\t\t\t\timg.alt = item.el.find('img').attr('alt');\n\t\t\t\t\t}\n\t\t\t\t\titem.img = $(img).on('load.mfploader', onLoadComplete).on('error.mfploader', onLoadError);\n\t\t\t\t\timg.src = item.src;\n\n\t\t\t\t\t// without clone() \"error\" event is not firing when IMG is replaced by new IMG\n\t\t\t\t\t// TODO: find a way to avoid such cloning\n\t\t\t\t\tif(el.is('img')) {\n\t\t\t\t\t\titem.img = item.img.clone();\n\t\t\t\t\t}\n\n\t\t\t\t\timg = item.img[0];\n\t\t\t\t\tif(img.naturalWidth > 0) {\n\t\t\t\t\t\titem.hasSize = true;\n\t\t\t\t\t} else if(!img.width) {\n\t\t\t\t\t\titem.hasSize = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tmfp._parseMarkup(template, {\n\t\t\t\t\ttitle: _getTitle(item),\n\t\t\t\t\timg_replaceWith: item.img\n\t\t\t\t}, item);\n\n\t\t\t\tmfp.resizeImage();\n\n\t\t\t\tif(item.hasSize) {\n\t\t\t\t\tif(_imgInterval) clearInterval(_imgInterval);\n\n\t\t\t\t\tif(item.loadError) {\n\t\t\t\t\t\ttemplate.addClass('mfp-loading');\n\t\t\t\t\t\tmfp.updateStatus('error', imgSt.tError.replace('%url%', item.src) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttemplate.removeClass('mfp-loading');\n\t\t\t\t\t\tmfp.updateStatus('ready');\n\t\t\t\t\t}\n\t\t\t\t\treturn template;\n\t\t\t\t}\n\n\t\t\t\tmfp.updateStatus('loading');\n\t\t\t\titem.loading = true;\n\n\t\t\t\tif(!item.hasSize) {\n\t\t\t\t\titem.imgHidden = true;\n\t\t\t\t\ttemplate.addClass('mfp-loading');\n\t\t\t\t\tmfp.findImageSize(item);\n\t\t\t\t}\n\n\t\t\t\treturn template;\n\t\t\t}\n\t\t}\n\t});\n});"]}